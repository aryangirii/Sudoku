<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Play Sudoku</title>
  <link rel="stylesheet" href="/static/style.css">
</head>
<body class="game-screen">
  <div class="container">
    <div class="header">
      <h1>Sudoku - {{ level.capitalize() }}</h1>
      <div class="game-info">
        <span id="timer">Time: 00:00</span>
        <span id="mistakes">Mistakes: 0</span>
      </div>
      <div class="button-group">
        <button onclick="toggleTheme()" class="theme-toggle">Toggle Dark Mode</button>
        <button onclick="window.location.href='{{ url_for('level') }}'" class="new-game">New Game</button>
        <button onclick="exitGame()" class="exit-game">Exit Game</button>
      </div>
    </div>

    <div class="sudoku-grid">
      {% for i, row in enumerate(puzzle) %}
        <div class="sudoku-row">
          {% for j, cell in enumerate(row) %}
            <input maxlength="1" class="sudoku-cell" 
                   data-row="{{ i }}" data-col="{{ j }}"
                   value="{{ cell if cell != 0 else '' }}" {{ 'readonly' if cell != 0 else '' }}>
          {% endfor %}
        </div>
      {% endfor %}
    </div>
  </div>

  <script>
    const solution = {{ solution|tojson }};
    let startTime = Date.now();
    let timer = document.getElementById('timer');
    let mistakes = 0;

    setInterval(() => {
      let elapsed = Math.floor((Date.now() - startTime) / 1000);
      let minutes = String(Math.floor(elapsed / 60)).padStart(2, '0');
      let seconds = String(elapsed % 60).padStart(2, '0');
      timer.textContent = `Time: ${minutes}:${seconds}`;
    }, 1000);

    function toggleTheme() {
      document.body.classList.toggle('dark-mode');
    }

    function exitGame() {
      if (confirm("Are you sure you want to exit the game?")) {
        window.location.href = '/';
      }
    }

    document.querySelectorAll('.sudoku-cell').forEach(cell => {
      const originalValue = cell.value;
      cell.addEventListener('input', () => {
        const val = cell.value;
        const row = parseInt(cell.getAttribute('data-row'));
        const col = parseInt(cell.getAttribute('data-col'));

        if (val && (isNaN(parseInt(val)) || parseInt(val) < 1 || parseInt(val) > 9)) {
          cell.value = '';
          return;
        }

        if (originalValue === '') {
          const correct = parseInt(val) === solution[row][col];
          if (!correct) {
            cell.classList.remove('correct');
            cell.classList.add('wrong');
            mistakes++;
            document.getElementById('mistakes').textContent = `Mistakes: ${mistakes}`;
          } else {
            cell.classList.remove('wrong');
            cell.classList.add('correct');
          }
        }
      });
    });
  </script>
</body>
</html>
